<prompt>
  <role>
    Voc√™ √© um desenvolvedor focado em criar uma interface simples, clara e funcional para configura√ß√£o de mensagens autom√°ticas e fluxos de atendimento via WhatsApp de uma corretora de seguros, usando IA da OpenAI.
  </role>

  <objetivo>
    Criar uma p√°gina web chamada Fluxo onde o usu√°rio possa:
    1) Ajustar os textos das mensagens padr√£o do agente de IA, com base no exemplo de atendimento fornecido.
    2) Cadastrar regras de resposta autom√°tica por palavra-chave (respostas simples, diretas).
    3) Configurar um fluxo de atendimento guiado por IA, definindo:
       - Um prompt global do agente/fluxo.
       - Um conjunto de etapas do fluxo, cada uma com seu pr√≥prio objetivo e instru√ß√µes em linguagem natural.
       - Regras de roteamento entre etapas descritas em texto livre, para que a IA decida sozinha para qual etapa seguir.
    4) Testar, em cada etapa, como a IA responderia e qual seria a pr√≥xima etapa, chamando a API da OpenAI (usando a chave armazenada nas Secrets do Replit).
  </objetivo>

<contexto_negocio>
Trata-se de uma corretora de seguros (Prevline Seguros) que atende leads via WhatsApp. Eles usam um agente de IA que precisa responder de forma cordial, profissional e objetiva, coletando informa√ß√µes do lead e conduzindo o fluxo at√© o preenchimento de um formul√°rio de cota√ß√£o.

````
```
A seguir est√° um exemplo real de atendimento que deve servir como refer√™ncia de tom de voz, sequ√™ncia de atendimento e tipo de perguntas feitas:
```
````

</contexto_negocio>

<exemplo_conversa_whatsapp>
[15:21, 18/11/2025] Gabriel Marquez: Boa tarde
[15:21, 18/11/2025] +55 31 7582-2396: A Prevline Seguros, agradece o contato.

```
‚úÖTrabalhamos com 15 Melhores Seguradoras.Ex: Porto Seguro, Azul, Allianz, HDI,Bradesco, etc.

‚ö†Seguro √© perfil de cliente n√£o conseguimos dar pre√ßo sem an√°lise de question√°rio de risco.

üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Nossa equipe √© refer√™ncia h√° mais de 15 anos.Consulte nossa avalia√ß√£o no Google.

üö® IMPORTANTE üö®
üìå Gentileza enviar sua solicita√ß√£o por escrito.
‚ùó N√£o ouvimos √°udio no WhatsApp! üîá
‚ùå N√£o atendemos liga√ß√µes pelo WhatsApp!

Vamos come√ßar seu atendimento. üòÄ
[15:21, 18/11/2025] +55 31 7582-2396: Oi, Gabriel! Tudo √≥timo por aqui, e com voc√™? Sou o IAGO, assistente do Daniel na Prevline Seguros. Voc√™ j√° √© cliente da Prevline ou deseja fazer uma nova cota√ß√£o?
[15:21, 18/11/2025] Gabriel Marquez: uma nova
[15:21, 18/11/2025] +55 31 7582-2396: √ìtimo, Gabriel! Para come√ßar, me confirma, por favor: voc√™ deseja um seguro novo para um carro, seguro residencial ou outro tipo de seguro?
[15:21, 18/11/2025] Gabriel Marquez: carro
[15:22, 18/11/2025] +55 31 7582-2396: Perfeito! Voc√™ j√° tem um seguro ativo desse ve√≠culo ou ser√° um seguro novo (primeira contrata√ß√£o)?
[15:22, 18/11/2025] Gabriel Marquez: primeira que fa√ßo
[15:22, 18/11/2025] +55 31 7582-2396: Certo! E voc√™ usa o ve√≠culo para transporte de aplicativo ou entregas (Uber, 99 ou outros Apps)?
[15:22, 18/11/2025] Gabriel Marquez: n√£o
[15:23, 18/11/2025] +55 31 7582-2396: √ìtimo! Posso te enviar o link do formul√°rio de cota√ß√£o para preencher? √â rapidinho.
[15:25, 18/11/2025] Gabriel Marquez: manda
[15:25, 18/11/2025] +55 31 7582-2396: Perfeito! Aqui est√° o link: https://prevlineseguros.aggilizador.com.br

Assim que preencher, me avise!
[15:41, 18/11/2025] Gabriel Marquez: Ok
[15:41, 18/11/2025] Gabriel Marquez: Eu consigo preencher por aqui? O link n√£o t√° abrindo
[15:45, 18/11/2025] +55 31 7582-2396: Somente pelo link mesmo
[15:45, 18/11/2025] +55 31 7582-2396: https://prevlineseguros.aggilizador.com.br/auto
[15:46, 18/11/2025] +55 31 7582-2396: Segue um link direcionado para a p√°gina de cota√ß√£o de seguro de carro
```

</exemplo_conversa_whatsapp>

<requisitos_funcionais>
A p√°gina deve se chamar Fluxo (t√≠tulo vis√≠vel na interface).

```
A p√°gina deve ter, no m√≠nimo, tr√™s √°reas principais:

1) √Årea de Mensagens Padr√£o
   - Campos de texto edit√°veis (multi-linha) para:
     a) Mensagem de boas-vindas.
     b) Mensagem institucional/explicativa da corretora (como o texto sobre seguradoras, perfil de risco e avalia√ß√£o no Google).
     c) Mensagem de instru√ß√µes importantes (como o texto sobre n√£o ouvir √°udio, n√£o atender liga√ß√µes, etc.).
   - Esses campos devem vir pr√©-preenchidos com textos baseados no exemplo de conversa acima, mas o usu√°rio deve poder editar livremente.

2) √Årea de Regras de Resposta por Palavra-chave (simples)
   - Exibir uma lista de regras de resposta.
   - Cada regra deve conter:
     a) Um campo de texto para a Palavra-chave ou frase do lead (por exemplo: "oi", "bom dia", "link", "formul√°rio").
     b) Um campo de texto multi-linha para a Mensagem de resposta que ser√° enviada quando a mensagem do lead contiver essa palavra/frase.
   - Deve haver um bot√£o para Adicionar nova regra que cria uma nova linha/conjunto de campos.
   - Deve haver a possibilidade de remover uma regra existente.
   - Essas regras s√£o apenas respostas diretas, independentes do fluxo com etapas de IA.

3) √Årea de Configura√ß√£o de Fluxo com IA (sem uso de palavra-chave para escolher etapa)
   - Ser√° detalhada em &lt;configuracao_ia_fluxo&gt; e deve aparecer visualmente separada das outras √°reas.
   - O fluxo entre etapas n√£o deve ser controlado por if/else ou palavras-chave no c√≥digo.
   - A decis√£o de qual etapa vem depois deve ser feita pela IA, com base:
     ‚Ä¢ No prompt global do fluxo.
     ‚Ä¢ Na defini√ß√£o em linguagem natural de cada etapa.
     ‚Ä¢ Nas instru√ß√µes de roteamento em linguagem natural escritas pelo usu√°rio.
     ‚Ä¢ No hist√≥rico da conversa e na mensagem atual do cliente.

Bot√µes gerais:
- Um bot√£o para Salvar ou Atualizar configura√ß√£o, que:
  - Simula o salvamento apenas na mem√≥ria da pr√≥pria p√°gina (estado/vari√°veis no frontend).
  - Exibe em uma √°rea de resumo o estado atual:
    ‚Ä¢ Mensagens padr√£o.
    ‚Ä¢ Regras de palavra-chave.
    ‚Ä¢ Configura√ß√£o do fluxo com IA (prompt global, etapas e instru√ß√µes de roteamento).

Importante:
- Nada precisa estar integrado ao WhatsApp de verdade; √© apenas uma tela de configura√ß√£o e testes.
- A interface deve deixar claro que:
  "O fluxo entre as etapas √© decidido pela IA com base nas instru√ß√µes em linguagem natural que voc√™ escrever (ex.: 'Siga para a etapa exemplo01 se o cliente demonstrar interesse, ou siga para a etapa exemplo02 se quiser plano de autom√≥vel')."
```

</requisitos_funcionais>

<configuracao_ia_fluxo>
A √Årea de Configura√ß√£o de Fluxo com IA deve permitir ao usu√°rio montar um fluxo de atendimento totalmente guiado por IA, sem uso de palavra-chave para selecionar etapas.

```
Estrutura m√≠nima:

1) Prompt Global do Fluxo / Agente de IA
   - Campo de texto multi-linha: "Prompt global do agente / fluxo".
   - Pr√©-preencher com um texto padr√£o baseado no contexto:
     - Papel do agente (assistente da Prevline Seguros).
     - Tom de voz (cordial, profissional, objetivo).
     - Objetivo geral (conduzir o lead at√© o preenchimento do formul√°rio de cota√ß√£o).
     - Regra geral de comportamento (sempre seguir as etapas definidas e usar as instru√ß√µes de roteamento em linguagem natural).
   - O usu√°rio pode editar esse texto livremente.
   - Este prompt ser√° usado como contexto/sistema em todas as chamadas √† IA.

2) Lista de Etapas do Fluxo (configuradas por IA)
   - Exibir uma lista din√¢mica de etapas.
   - Cada etapa deve conter, no m√≠nimo:
     a) Campo de texto: "ID da etapa" (ex.: "exemplo01", "exemplo02", "boas_vindas", "coleta_dados_auto").
        - Texto curto, sem espa√ßos, para refer√™ncia interna.
     b) Campo de texto: "Nome da etapa" (r√≥tulo amig√°vel para o usu√°rio).
     c) Campo multi-linha: "Objetivo da etapa" (o que essa etapa deve alcan√ßar).
     d) Campo multi-linha: "Prompt da etapa" (texto em linguagem natural dizendo como o agente deve se comportar naquela etapa).
        - Exemplo de orienta√ß√£o para o usu√°rio (placeholder):
          "Nesta etapa, fa√ßa perguntas para descobrir se o cliente tem interesse real em fechar, pe√ßa os dados X e Y. N√£o ofere√ßa pre√ßo. Se o cliente demonstrar falta de interesse claro, considere encerrar o fluxo com educa√ß√£o."
     e) Campo multi-linha: "Instru√ß√µes de roteamento em linguagem natural"
        - Campo onde o usu√°rio escreve regras como:
          "Siga para a etapa 'exemplo01' se o cliente demonstrar interesse em fechar.
           Siga para a etapa 'exemplo02' se ele quiser plano de autom√≥vel.
           Se o cliente recusar totalmente, siga para a etapa 'encerrar_fluxo'."
        - Essas instru√ß√µes N√ÉO ser√£o convertidas em if/else no c√≥digo; ser√£o apenas texto passado para a IA.
     f) Campo multi-linha opcional: "Exemplo de mensagem do cliente para teste".
     g) Um bot√£o "Gerar resposta de exemplo com IA" para essa etapa.

   - Deve haver um bot√£o "Adicionar etapa" que cria um novo bloco de campos de etapa.
   - Deve haver a possibilidade de remover uma etapa existente.

   - Nenhuma etapa deve ter campo de "palavras-chave gatilho". Todo o roteamento √© feito pela IA com base nessas instru√ß√µes textuais.

3) L√≥gica de chamada √† API da OpenAI (preview/teste de etapa)
   - Ao clicar em "Gerar resposta de exemplo com IA" em uma etapa:
     - O frontend deve enviar uma requisi√ß√£o POST para um endpoint backend, por exemplo: /api/ia/preview.
     - O corpo da requisi√ß√£o (JSON) deve conter, no m√≠nimo:

       {
         promptGlobal,
         etapaAtual: {
           id,
           nome,
           objetivo,
           promptEtapa,
           instrucoesRoteamento
         },
         etapasDefinidas: [lista completa das etapas com seus ids e nomes],
         historicoConversaExemplo: [array simples de mensagens, opcional],
         mensagemClienteExemplo: "texto digitado ou configurado para teste"
       }

     - O backend deve:
       a) Montar um "prompt t√©cnico fixo" de orquestra√ß√£o (hard-coded) que instrui a IA a:
          - Ler o promptGlobal.
          - Ler os dados da etapaAtual e as instrucoesRoteamento.
          - Usar historicoConversaExemplo e mensagemClienteExemplo.
          - Decidir:
            ‚Ä¢ Qual texto o agente deve responder agora.
            ‚Ä¢ Qual deve ser a pr√≥xima etapa (proximaEtapaId), usando os IDs configurados.
          - Sempre responder em JSON v√°lido, por exemplo:

            {
              "mensagemAgente": "texto que ser√° enviado ao cliente",
              "proximaEtapaId": "exemplo01"
            }

            Onde "proximaEtapaId" pode ser:
            - O ID de alguma etapa existente da lista.
            - Null ou "encerrar" para finalizar o fluxo.

       b) Chamar a API de chat da OpenAI usando a vari√°vel de ambiente process.env.OPENAI_API_KEY (Secrets do Replit).
       c) Utilizar um modelo de chat leve (ex.: "gpt-4.1-mini" ou similar).
       d) Devolver ao frontend o JSON j√° parseado (mensagemAgente, proximaEtapaId).

   - No frontend, a resposta da IA deve ser exibida logo abaixo dos campos da etapa, em um painel do tipo:
     - T√≠tulo: "Resposta de exemplo da IA para esta etapa".
     - Mostrar:
       ‚Ä¢ "Mensagem do agente:" (texto gerado).
       ‚Ä¢ "Pr√≥xima etapa sugerida pela IA:" (id retornado).

4) Resumo do Fluxo
   - Abaixo da √°rea de configura√ß√£o de fluxo com IA, exibir um painel de resumo com:
     - Prompt global atual.
     - Lista de etapas (id, nome, objetivo).
     - Para cada etapa, uma visualiza√ß√£o compacta das instrucoesRoteamento.
   - Esse resumo serve apenas para visualiza√ß√£o na interface, sem necessidade de persist√™ncia em banco de dados.

5) Regra central:
   - Nenhuma transi√ß√£o entre etapas deve ser baseada em compara√ß√£o de string ou palavras-chave no c√≥digo.
   - O c√≥digo sempre deve delegar √† IA a escolha da pr√≥xima etapa, de acordo com o texto configurado pelo usu√°rio em "Prompt da etapa" e "Instru√ß√µes de roteamento em linguagem natural".
```

</configuracao_ia_fluxo>

<interface_esperada>
A interface deve ser intuitiva e organizada, com:

```
- T√≠tulo da p√°gina: "Fluxo de Atendimento ‚Äì Prevline Seguros".
- Se√ß√µes visualmente separadas para:
  1) Mensagens padr√£o.
  2) Regras de resposta por palavra-chave (simples).
  3) Fluxo com IA (prompt global + etapas e roteamento por IA).

Em cada se√ß√£o, identifique claramente os r√≥tulos dos campos, por exemplo:
- "Mensagem de boas-vindas"
- "Mensagem institucional"
- "Instru√ß√µes importantes"
- "Palavra-chave do lead"
- "Resposta autom√°tica"
- "Prompt global do agente / fluxo"
- "ID da etapa"
- "Nome da etapa"
- "Objetivo da etapa"
- "Prompt da etapa"
- "Instru√ß√µes de roteamento em linguagem natural"
- "Exemplo de mensagem do cliente"
- "Gerar resposta de exemplo com IA"
- "Adicionar regra"
- "Adicionar etapa"
- "Remover"
- "Salvar fluxo"

Todos os textos, r√≥tulos e placeholders devem estar em portugu√™s do Brasil.
```

</interface_esperada>

<comportamento_dinamico>
- Ao clicar em "Adicionar regra", deve aparecer um novo bloco de campos para cadastrar mais uma combina√ß√£o Palavra-chave ‚Üí Resposta autom√°tica simples.
- Ao clicar em "Remover" em uma regra, essa regra deve ser removida da listagem.

```
- Ao clicar em "Adicionar etapa", deve aparecer um novo bloco de campos para cadastrar mais uma etapa do fluxo com IA (ID, nome, objetivo, prompt da etapa, instru√ß√µes de roteamento).
- Ao clicar em "Remover" em uma etapa, essa etapa deve ser removida da listagem.

- Ao clicar em "Gerar resposta de exemplo com IA" em uma etapa:
  - O frontend envia a requisi√ß√£o para o backend com os dados do fluxo e da etapa atual.
  - O backend consulta a API da OpenAI conforme descrito em &lt;configuracao_ia_fluxo&gt;.
  - A resposta (mensagemAgente e proximaEtapaId) √© exibida na interface, abaixo da etapa.

- Ao clicar em "Salvar fluxo":
  - Simule o salvamento em mem√≥ria (por exemplo, usando estado em JavaScript).
  - Exiba claramente, em um painel de resumo:
    ‚Ä¢ As mensagens padr√£o.
    ‚Ä¢ As regras de palavra-chave.
    ‚Ä¢ O prompt global.
    ‚Ä¢ A lista de etapas, com seus objetivos e instru√ß√µes de roteamento.
```

</comportamento_dinamico>

<tom_e_estilo>
- Estilo visual simples e limpo, com boa legibilidade.
- Tom dos textos da interface profissional, cordial e objetivo.
</tom_e_estilo>

  <saida>
    Gere o c√≥digo completo necess√°rio para:

````
1) Um backend simples em Node.js com Express (ou equivalente) que:
   - Sirva a p√°gina Fluxo.
   - Exponha um endpoint POST /api/ia/preview (ou nome semelhante) que:
     ‚Ä¢ Leia process.env.OPENAI_API_KEY.
     ‚Ä¢ Monte o prompt t√©cnico de orquestra√ß√£o.
     ‚Ä¢ Chame a API de chat da OpenAI.
     ‚Ä¢ Retorne a resposta da IA em JSON (mensagemAgente, proximaEtapaId).

2) Um frontend em HTML, CSS e JavaScript puro com a p√°gina Fluxo, contendo todas as se√ß√µes e comportamentos descritos.

O projeto deve ser compat√≠vel com um ambiente simples do Replit (Node.js + HTML est√°tico).

```
N√£o escreva explica√ß√µes, coment√°rios externos ou instru√ß√µes adicionais fora do c√≥digo.
Responda apenas com o c√≥digo final dos arquivos do projeto (backend e frontend), sem texto extra antes ou depois.
Se precisar de mais de um arquivo, inclua todos no mesmo bloco de resposta, deixando claro o nome de cada arquivo (por exemplo, usando coment√°rios no in√≠cio).
```
````

  </saida>

  <restricoes>
    - N√£o utilizar integra√ß√µes reais com API do WhatsApp; tudo √© apenas interface de configura√ß√£o e testes de resposta.
    - Manter todos os textos da interface em portugu√™s.
    - √â obrigat√≥rio usar a API da OpenAI para gerar as respostas de exemplo e decidir a pr√≥xima etapa, lendo a chave da vari√°vel de ambiente OPENAI_API_KEY (Secrets do Replit) no backend.
    - N√£o expor a chave da OpenAI no frontend.
    - N√£o adicionar funcionalidades al√©m das descritas neste prompt.
  </restricoes>
</prompt>
