Perfeito, então hoje você só está criando a instância e mostrando o card, mas em nenhum momento está:

1. Chamando o endpoint do WAHA que devolve o QR
2. Nem exibindo esse QR em algum modal/componente no React

Vou te passar o que falta, passo a passo, bem direto.

---

## 1. O que você precisa ter no backend

### 1.1. Rota para pegar o QR da instância

Use o endpoint do WAHA:

* `GET /api/{session}/auth/qr?format=image` com `Accept: application/json`
* Ele devolve algo assim:

````json
{
  "mimetype": "image/png",
  "data": "base64-encoded-data"
}
``` :contentReference[oaicite:0]{index=0}

Cria uma rota no seu Express, por exemplo `GET /api/instances/:id/qr`:

```ts
// src/routes/instances.ts
import { Router } from "express";
import axios from "axios";
import { db } from "../db";
import { instances } from "../db/schema";
import { eq } from "drizzle-orm";

export const instancesRouter = Router();

instancesRouter.get("/:id/qr", async (req, res) => {
  const id = Number(req.params.id);
  if (Number.isNaN(id)) {
    return res.status(400).json({ error: "ID inválido" });
  }

  const instance = await db.query.instances.findFirst({
    where: eq(instances.id, id),
  });

  if (!instance) {
    return res.status(404).json({ error: "Instância não encontrada" });
  }

  try {
    const url = `${process.env.WAHA_API}/api/${instance.name}/auth/qr?format=image`;

    const wahaRes = await axios.get(url, {
      headers: {
        Accept: "application/json",
        "X-Api-Key": process.env.WAHA_API_KEY as string,
      },
    });

    const { mimetype, data } = wahaRes.data;

    return res.json({ mimetype, data });
  } catch (err: any) {
    console.error("Erro ao buscar QR no WAHA:", err.response?.data ?? err);
    return res
      .status(500)
      .json({ error: "Erro ao buscar QR Code no WAHA para esta instância" });
  }
});
````

Essa rota:

* Busca a instância no Postgres pelo `id`
* Usa o `name` dela como `{session}` no WAHA
* Pede o QR em base64 e devolve pro frontend

> Importante: não chame WAHA direto do React, sempre via backend, pra não expor `WAHA_API_KEY`.

---

### 1.2. (Opcional, mas recomendado) Rota para iniciar a sessão se estiver parada

Se você criou a sessão com `start: false`, o WAHA deixa em `STOPPED` e você precisa chamar:

* `POST /api/sessions/{session}/start` para iniciar a sessão ([WAHA][1])

Pode criar algo assim:

```ts
instancesRouter.post("/:id/start", async (req, res) => {
  const id = Number(req.params.id);
  const instance = await db.query.instances.findFirst({
    where: eq(instances.id, id),
  });

  if (!instance) {
    return res.status(404).json({ error: "Instância não encontrada" });
  }

  try {
    const url = `${process.env.WAHA_API}/api/sessions/${instance.name}/start`;

    const wahaRes = await axios.post(
      url,
      {},
      {
        headers: {
          Accept: "application/json",
          "X-Api-Key": process.env.WAHA_API_KEY as string,
        },
      }
    );

    // Se quiser, atualize o status no banco aqui
    return res.json(wahaRes.data);
  } catch (err: any) {
    console.error("Erro ao iniciar sessão WAHA:", err.response?.data ?? err);
    return res.status(500).json({ error: "Erro ao iniciar sessão no WAHA" });
  }
});
```

Fluxo possível no front: se o status for “Parado”, você chama `/instances/:id/start` antes de buscar o QR.

---

## 2. O que falta no frontend (React)

Hoje você só mostra o card da instância (como na tela). Agora precisa:

1. Um botão “Conectar” / “Ler QR” nesse card
2. Um estado pra guardar o QR retornado
3. Um modal/box que exibe o QR (`<img>`)

### 2.1. Estado e função para buscar o QR

Exemplo simplificado:

```tsx
// src/pages/InstancesPage.tsx
import { useState, useEffect } from "react";
import axios from "axios";

type Instance = {
  id: number;
  name: string;
  status: string;
  createdAt: string;
};

export function InstancesPage() {
  const [instances, setInstances] = useState<Instance[]>([]);
  const [qrImg, setQrImg] = useState<string | null>(null);
  const [qrInstanceName, setQrInstanceName] = useState<string | null>(null);

  useEffect(() => {
    loadInstances();
  }, []);

  async function loadInstances() {
    const res = await axios.get<Instance[]>("/api/instances");
    setInstances(res.data);
  }

  async function handleShowQr(instance: Instance) {
    // Se quiser, pode chamar /start aqui se status === "Parado"
    // await axios.post(`/api/instances/${instance.id}/start`);

    const res = await axios.get(`/api/instances/${instance.id}/qr`);
    const { mimetype, data } = res.data;

    setQrInstanceName(instance.name);
    setQrImg(`data:${mimetype};base64,${data}`);
  }

  function closeQr() {
    setQrImg(null);
    setQrInstanceName(null);
  }

  return (
    <div className="p-6">
      {/* título da página... */}

      <div className="space-y-4">
        {instances.map((inst) => (
          <div key={inst.id} className="bg-zinc-900 p-4 rounded-lg">
            <div className="flex items-center justify-between">
              <div>
                <div className="font-medium">{inst.name}</div>
                <div className="text-xs text-zinc-400">
                  Criado em {new Date(inst.createdAt).toLocaleDateString("pt-BR")}
                </div>
              </div>

              <div className="flex gap-2">
                {/* botão existente de Atualizar Status, se tiver */}
                <button className="btn-secundario">
                  Atualizar Status
                </button>

                <button
                  className="btn-primario"
                  onClick={() => handleShowQr(inst)}
                >
                  Conectar / Ler QR
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Modal simples de QR */}
      {qrImg && (
        <div className="fixed inset-0 bg-black/60 flex items-center justify-center">
          <div className="bg-zinc-900 p-6 rounded-xl w-full max-w-sm text-center">
            <h2 className="text-lg font-semibold mb-4">
              Escaneie o QR no WhatsApp
              {qrInstanceName ? ` (${qrInstanceName})` : ""}
            </h2>

            <img
              src={qrImg}
              alt="QR Code WhatsApp"
              className="mx-auto mb-4 rounded-lg"
            />

            <p className="text-xs text-zinc-400 mb-4">
              Abra o WhatsApp &gt; Menu &gt; Dispositivos conectados &gt; Conectar
              um dispositivo.
            </p>

            <button className="btn-secundario w-full" onClick={closeQr}>
              Fechar
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

Adapte para o seu design (botões, classes etc.), mas a lógica é essa:

* Clicar no botão do card → `GET /api/instances/:id/qr`
* Transformar o base64 em `data:image/...;base64,...`
* Exibir o `<img>` com esse `src`

---

## 3. Teste rápido pra ver se o problema é WAHA ou seu código

Antes de culpar o front/back:

1. No Postman ou curl, testa direto no WAHA:

```bash
curl -X GET \
  "$WAHA_API/api/NOME_DA_SESSAO/auth/qr?format=image" \
  -H "Accept: application/json" \
  -H "X-Api-Key: $WAHA_API_KEY"
```

* Se voltar JSON com `mimetype` e `data`, WAHA está ok, o problema é só integração. ([WAHA][1])
* Se der erro, vê se a sessão não está em `STOPPED` e, se estiver, roda:

````bash
curl -X POST \
  "$WAHA_API/api/sessions/NOME_DA_SESSAO/start" \
  -H "Accept: application/json" \
  -H "X-Api-Key: $WAHA_API_KEY"
``` :contentReference[oaicite:3]{index=3}  

---

## 4. Resumindo o que falta pra aparecer o QR

1. Backend: rota `GET /api/instances/:id/qr` que chama `GET /api/{session}/auth/qr?format=image` no WAHA e devolve `{ mimetype, data }`.
2. Frontend: botão no card da instância que chama essa rota e abre um modal com `<img src="data:${mimetype};base64,${data}" />`.
3. Se a instância estiver “Parado/STOPPED”, iniciar antes com `POST /api/sessions/{session}/start`.

Se quiser, no próximo passo você pode me mandar o trecho de código do backend/React que lida com criação da instância, que eu adapto exatamente pra essa tela que você me mostrou.
::contentReference[oaicite:4]{index=4}
````

[1]: https://waha.devlike.pro/docs/how-to/sessions/?utm_source=chatgpt.com "Sessions | WAHA"
